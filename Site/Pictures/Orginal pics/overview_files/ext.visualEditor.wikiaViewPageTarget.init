mw.loader.implement("ext.visualEditor.wikiaViewPageTarget.init",function($){(function(){var conf,tabMessages,uri,pageExists,viewUri,veEditUri,viewPage,init,support,getTargetDeferred,vePreferred,browserSupported,plugins=[],trackerConfig={'category':'editor-ve','trackingMethod':'both'},indicatorTimeoutId=null;function initIndicator(){var $indicator=$('<div>').addClass('ve-indicator visible').attr('data-type','loading'),$content=$('<div>').addClass('content'),$icon=$('<div>').addClass('loading'),$message=$('<p>').addClass('message').text(mw.message('wikia-visualeditor-loading').plain());$content.append($icon).append($message);$indicator.append($content).appendTo($('body')).css('opacity',1).hide();mw.hook('ve.activationComplete').add(function hide(){if(indicatorTimeoutId){clearTimeout(indicatorTimeoutId);indicatorTimeoutId=null;}if($indicator.is(':visible')){$indicator.fadeOut(400);}});}function showIndicator(){var $indicator=$('.ve-indicator[data-type="loading"]'),$message=$indicator.find
('p.message');$message.hide();$indicator.fadeIn(400);indicatorTimeoutId=setTimeout(function(){if($indicator.is(':visible')){$message.slideDown(400);}},3000);}initIndicator();function getTarget(){var loadTargetDeferred;showIndicator();if(!getTargetDeferred){Wikia.Tracker.track(trackerConfig,{'action':Wikia.Tracker.ACTIONS.IMPRESSION,'label':'edit-page'});getTargetDeferred=$.Deferred();loadTargetDeferred=$.Deferred();$.when(loadTargetDeferred,$.getResources($.getSassCommonURL('/extensions/VisualEditor/wikia/VisualEditor.scss'))).done(function(){var target=new ve.init.mw.WikiaViewPageTarget();ve.init.mw.targets.push(target);ve.init.mw.WikiaViewPageTarget.prototype.setupSectionEditLinks=init.setupSectionLinks;target.addPlugins(plugins);getTargetDeferred.resolve(target);}).fail(getTargetDeferred.reject);mw.loader.using('ext.visualEditor.wikiaViewPageTarget',loadTargetDeferred.resolve,loadTargetDeferred.reject);}return getTargetDeferred.promise();}conf=mw.config.get('wgVisualEditorConfig');
tabMessages=conf.tabMessages;uri=new mw.Uri(location.href);pageExists=!!mw.config.get('wgArticleId')||mw.config.get('wgNamespaceNumber')<0;viewUri=new mw.Uri(mw.util.getUrl(mw.config.get('wgRelevantPageName')));veEditUri=viewUri.clone().extend({'veaction':'edit'});viewPage=(mw.config.get('wgIsArticle')&&!('diff'in uri.query));vePreferred=!!mw.config.get('wgVisualEditorPreferred');support={es5:!!(Array.isArray&&Array.prototype.filter&&Array.prototype.indexOf&&Array.prototype.map&&Date.now&&Date.prototype.toJSON&&Function.prototype.bind&&Object.create&&Object.keys&&String.prototype.trim&&window.JSON&&JSON.parse&&JSON.stringify),contentEditable:'contentEditable'in document.createElement('div')};init={activateOnPageLoad:uri.query.veaction==='edit',support:support,blacklist:conf.blacklist,addPlugin:function(plugin){plugins.push(plugin);},setupTabs:function(){$('#ca-ve-edit').click(init.onEditTabClick);},setupSectionLinks:function(){$('#mw-content-text').find('.editsection a').click(init.
onEditSectionLinkClick);},onEditTabClick:function(e){if((e.which&&e.which!==1)||e.shiftKey||e.altKey||e.ctrlKey||e.metaKey){if(window.veTrack){veTrack({action:'ve-edit-page-ignored',trigger:'onEditTabClick'});}return;}e.preventDefault();Wikia.Tracker.track(trackerConfig,{'action':Wikia.Tracker.ACTIONS.CLICK,'category':'article','label':'ve-edit'});if(window.veTrack){veTrack({action:'ve-edit-page-start',trigger:'onEditTabClick'});}getTarget().done(function(target){target.activate();});},onEditSectionLinkClick:function(e){if((e.which&&e.which!==1)||e.shiftKey||e.altKey||e.ctrlKey||e.metaKey){if(window.veTrack){veTrack({action:'ve-edit-page-ignored',trigger:'onEditTabClick'});}return;}e.preventDefault();Wikia.Tracker.track(trackerConfig,{'action':Wikia.Tracker.ACTIONS.CLICK,'category':'article','label':'ve-section-edit'});if(window.veTrack){veTrack({action:'ve-edit-page-start',trigger:'onEditSectionLinkClick'});}getTarget().done(function(target){target.saveEditSection($(e.target).closest(
'h1, h2, h3, h4, h5, h6').get(0));target.activate();});}};browserSupported=support.es5&&support.contentEditable&&(('vewhitelist'in uri.query)||!$.client.test(init.blacklist,null,true));init.isInValidNamespace=function(article){return $.inArray(new mw.Title(article).getNamespaceId(),conf.namespaces)!==-1;};init.canCreatePageUsingVE=function(){return browserSupported&&vePreferred;};window.mw.libs.ve=init;function setupRedlinks(){$(document).on('mouseover click','a[href*="action=edit"][href*="&redlink"]:not([href*="veaction=edit"])',function(){var $element=$(this),href=$element.attr('href'),articlePath=mw.config.get('wgArticlePath').replace('$1',''),redlinkArticle=new mw.Uri(href).path.replace(articlePath,'');if(init.isInValidNamespace(redlinkArticle)){$element.attr('href',href.replace('action=edit','veaction=edit'));}});}function removeVELink(){var $edit=$('#ca-edit'),$veEdit=$('#ca-ve-edit');$('html').addClass('ve-not-available');if(vePreferred&&$veEdit.length>0){$veEdit.attr({href:
$edit.attr('href'),accesskey:$edit.attr('accesskey')});$edit.parent().remove();}else{$veEdit.parent().remove();}}if(browserSupported){if(viewPage&&init.isInValidNamespace(mw.config.get('wgRelevantPageName'))){$(function(){if(init.activateOnPageLoad){if(window.veTrack){veTrack({action:'ve-edit-page-start',trigger:'activateOnPageLoad'});}getTarget().done(function(target){target.activate();});}init.setupTabs();if(vePreferred){init.setupSectionLinks();}});}else{removeVELink();}if(vePreferred){$(setupRedlinks);}}else{removeVELink();}}());;},{},{"wikia-visualeditor-loading":"Loading the VisualEditor..."});

/* cache key: bioshock:resourceloader:filter:minify-js:7:8a752aae250c5ead461bd280b52db652 */