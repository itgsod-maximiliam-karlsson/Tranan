
define('thumbnails.templates.mustache',[],function(){'use strict';return{"thumbnailVideo":'<ahref="{{ linkHref }}"class="video video-thumbnail {{ size }} {{# linkClasses }}{{ . }} {{/ linkClasses }}"{{# linkAttrs }}{{ . }} {{/ linkAttrs }}><span class="play-circle"></span><imgsrc="{{ imgSrc }}"{{# imgClass }}class="{{ imgClass }}"{{/ imgClass }}data-video-key="{{ videoKey }}"data-video-name="{{ videoName }}"{{# imgWidth }} width="{{ imgWidth }}" {{/ imgWidth}}{{# imgHeight }} height="{{ imgHeight }}" {{/ imgHeight}}{{# imgAttrs }}{{ . }} {{/ imgAttrs }}><span class="duration" {{# durationAttrs }}{{ . }} {{/ durationAttrs }}>{{ duration }}</span>{{# metaAttrs }}<meta itemprop="{{itemprop}}" content="{{content}}">{{/ metaAttrs }}</a>',"titleThumbnail":'{{{thumbnail}}}<div class="title" title="{{title}}"><a href="{{url}}">{{title}}</a></div>',"done":"true"};});;define('thumbnails.views.titleThumbnail',['thumbnails.templates.mustache','wikia.mustache'],function(templates,Mustache){'use strict';function TitleView(options){this.model=options.model;this.el=document.createElement(options.el||'div');this.isFluid=(typeof options.isFluid==='undefined')?true:options.isFluid;this.initialize();}
TitleView.prototype.render=function(){this.el.className+=' title-thumbnail';this.el.innerHTML=Mustache.render(templates.titleThumbnail,this.model);this.$el=$(this.el);return this;};TitleView.prototype.initialize=function(){var self=this;if(this.isFluid){$(window).resize(function(){self.applyEllipses();});}};TitleView.prototype.applyEllipses=function(config){this.$el.find('.title a').ellipses(config);};return TitleView;});;define('videosmodule.templates.mustache',[],function(){'use strict';return{"bottomModule":'<section id="videosModule" class="videos-module"><h2>{{title}}</h2><ul class="thumbnails small-block-grid-3 large-block-grid-3 x-large-block-grid-4"></ul></section>',"done":"true"};});;define('videosmodule.models.videos',['wikia.nirvana'],function(nirvana){'use strict';var VideosData=function(){this.data=null;this.articleId=window.wgArticleId||null;};VideosData.prototype.fetch=function(){var ret,self=this;if(this.data!==null){ret=this.data;}else{ret=nirvana.getJson('VideosModuleController','index',{articleId:this.articleId}).done(function(data){self.data=data;});}
return ret;};return VideosData;});;define('videosmodule.views.titleThumbnail',['thumbnails.views.titleThumbnail','wikia.tracker'],function(TitleThumbnail,Tracker){'use strict';var track=Tracker.buildTrackingFunction({category:'videos-module-rail',trackingMethod:'both',action:Tracker.ACTIONS.CLICK,label:'thumbnail-click'});function VideosModuleThumbnail(config){this.idx=config.idx;TitleThumbnail.call(this,config);}
VideosModuleThumbnail.prototype=Object.create(TitleThumbnail.prototype);VideosModuleThumbnail.prototype.bindEvents=function(){var self=this;this.$el.on('mousedown','a',function(){track({value:self.idx});return true;});};VideosModuleThumbnail.prototype.render=function(){this.constructor.prototype.render.call(this);this.bindEvents();return this;};return VideosModuleThumbnail;});;define('videosmodule.views.bottomModule',['sloth','videosmodule.views.titleThumbnail','wikia.mustache','videosmodule.templates.mustache','wikia.tracker'],function(sloth,TitleThumbnailView,Mustache,templates,Tracker){'use strict';var track,groupParams;groupParams={rows:2,position:1};track=Tracker.buildTrackingFunction({category:'videos-module-bottom',trackingMethod:'both',action:Tracker.ACTIONS.IMPRESSION});function VideoModule(options){this.el=options.el;this.$el=$(options.el);this.model=options.model;this.articleId=window.wgArticleId;if(this.articleId){this.init();}}
VideoModule.prototype.init=function(){var self=this;this.data=this.model.fetch();sloth({on:this.el,threshold:200,callback:function(){self.data.complete(function(){self.handleRelatedPages();});}});};VideoModule.prototype.handleRelatedPages=function(){var self=this;if(this.elContentPresent()){this.onRelatedPagesLoad();}else{this.$el.on('afterLoad.relatedPages',function(){if(self.elContentPresent()){self.onRelatedPagesLoad();}});}};VideoModule.prototype.onRelatedPagesLoad=function(){track({label:'related-pages-impression'});this.render();};VideoModule.prototype.elContentPresent=function(){var $content=this.$el.children();return!!($content.length&&!$content.is(':hidden')&&$content.css('visibility')!=='hidden'&&$content.css('opacity')!=='0'&&$content.height()!==0);};VideoModule.prototype.render=function(){var i,$out,videos=this.model.data.videos,len=videos.length,instance,thumbnailViews=[];if(!len){return;}
videos=videos.slice(0,groupParams.rows>1?8:4);$out=$(Mustache.render(templates.bottomModule,{title:$.msg('videosmodule-title-default')}));for(i=0;i<(groupParams.rows*4);i++){instance=new TitleThumbnailView({el:'li',model:videos[i],idx:i}).render();$out.find('.thumbnails').append(instance.$el);thumbnailViews.push(instance);}
$out.addClass(groupParams.rows>1?'rows-2':'rows-1');if(groupParams.position===1){this.$el.before($out);}else{this.$el.after($out);}
$.each(thumbnailViews,function(){this.applyEllipses({wordsHidden:2});});track({label:'module-impression'});};return VideoModule;});;define('videosmodule.views.rail',['videosmodule.views.titleThumbnail','wikia.tracker','wikia.log'],function(TitleThumbnailView,Tracker,log){'use strict';var track;track=Tracker.buildTrackingFunction({category:'videos-module-rail',trackingMethod:'both',action:Tracker.ACTIONS.IMPRESSION,label:'module-impression'});function VideoModule(options){this.el=options.el;this.$el=$(options.el);this.$thumbs=this.$el.find('.thumbnails');this.model=options.model;this.articleId=window.wgArticleId;this.numVids=5;if(this.articleId){this.init();}}
VideoModule.prototype.init=function(){var self=this;self.$thumbs.addClass('hidden');self.$el.startThrobbing().removeClass('hidden');this.model.fetch().complete(function(){self.render();});};VideoModule.prototype.render=function(){var i,videos=this.model.data.videos,staffPickVideos=this.model.data.staffVideos,len=videos.length,thumbHtml=[],self=this,$imagesLoaded=$.Deferred(),imgCount=0,VideosIndex,StaffPicksIndex;if(!len){this.$el.addClass('hidden');log('No videos were returned for VideosModule rail',log.levels.error,'VideosModule',true);return;}
this.shuffle(videos);if(staffPickVideos.length){VideosIndex=Math.floor(Math.random()*this.numVids);StaffPicksIndex=Math.floor(Math.random()*staffPickVideos.length);videos[VideosIndex]=staffPickVideos[StaffPicksIndex];}
for(i=0;i<this.numVids;i++){thumbHtml.push(new TitleThumbnailView({el:'li',model:videos[i],idx:i}).render().$el);}
this.$thumbs.append(thumbHtml).find('img[data-video-key]').on('load error',function(){imgCount+=1;if(imgCount===self.numVids){$imagesLoaded.resolve();}});$.when($imagesLoaded).done(function(){self.$thumbs.removeClass('hidden');self.$el.stopThrobbing();});track();};VideoModule.prototype.shuffle=function(array){var i,j,temp;for(i=array.length-1;i>0;i--){j=Math.floor(Math.random()*(i+1));temp=array[i];array[i]=array[j];array[j]=temp;}
return array;};return VideoModule;});;require(['videosmodule.views.rail','videosmodule.models.videos'],function(RailModule,VideoData){'use strict';$(function(){$('#WikiaRail').on('afterLoad.rail',function(){return new RailModule({el:document.getElementById('videosModule'),model:new VideoData(),isFluid:false});});});});;